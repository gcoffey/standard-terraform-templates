resource:
  name: "azurerm_app_service_slot"
  enable_variable_comments: false
  var_name: "app_service_slot"
  required_vars:
    - name: "name"
      description: "Specifies the name of the App Service Slot"
      type: "string"
    - name: "resource_group_name"
      description: "The name of the Resource group in which the App Service Slot should be created"
      type: "string"
    - name: "location"
      description: "Specifies the supported Azure location where the resource exists"
      type: "string"
    - name: "app_service_plan_id"
      description: "The ID of the App Service Plan within which to create this App Service Slot"
      type: "string"
    - name: "app_service_name"
      description: "The name of the App Service within which to create the App Service Slot"
      type: "string"
  optional_vars:
    - name: "app_settings"
      description: "A key-value pair of App Settings"
      type: "block"
    - name: "auth_settings"
      description: "An auth settings block"
      type: "block"
    - name: "connection_string"
      description: "A connection string block"
      type: "block"
    - name: "client_affinity_enabled"
      description: "Should the App Service Slot send session affinity cookies"
      type: "boolean"
    - name: "enabled"
      description: "Is the App Service Slot Enabled? Default true"
      type: "boolean"
    - name: "https_only"
      description: "Can the App Service Slot only be accessed via HTTPS; Default false"
      type: "boolean"
    - name: "site_config"
      description: "A site config block"
      type: "block"
    - name: "storage_account"
      description: "One or more storage account blocks"
      type: "block"
    - name: "logs"
      description: "A logs block"
      type: "block"
    - name: "identity"
      description: "An identity block"
      type: "block"
    - name: "key_vault_reference_identity_id"
      description: "The User Assigned Identity Id used for looking up KeyVault secrets"
      type: "string"
    - name: "tags"
      description: "A mapping of tags"
      type: "list"

blocks:
  - name: "app_settings"
    required: false
    description: "App Settings Block"
    required_vars:
      - name: "KEY"
        description: "KEY / VALUE pair"
        type: "string"
  - name: "storge_account"
    required: false
    description: "Storage Account Block"
    required_vars:
      - name: "name"
        description: "The name of the storage account identifier"
        type: "string"
      - name: "type"
        description: "The type of storage; AzureBlob or AzureFiles"
        type: "string"
      - name: "account_name"
        description: "The name of the storage account"
        type: "string"
      - name: "share_name"
        description: "The name of the file share, container name when type = AzureBlob"
        type: "string"
      - name: "access_key"
        description: "The access key for the storage account"
        type: "string"
    optional_vars:
      - name: "mount_path"
        description: "The path to mount the storage within the site's runtime environment"
        type: "string"
  - name: "connection_string"
    required: false
    description: "Connection String Block"
    required_vars:
      - name: "name"
        description: "The name of the connection string"
        type: "string"
      - name: "type"
        description: "The type of connection string; APIHub, Custom, DocDb, EventHub, MySQL, NotificationHub, PostgreSQL etc"
        type: "string"
      - name: "value"
        description: "The value for the Connection String"
        type: "string"
  - name: "site_config"
    required: false
    description: "Site Config Block"
    optional_vars: 
      - name: "acr_use_managed_identity_credentials"
        description: "Are Managed Identity Credentials used for Azure Container Registry Pull"
        type: "boolean"
      - name: "acr_user_managed_identity_client_id"
        description: "If using User Managed IDentity, the User Managed Identity Client Id"
        type: "string"
      - name: "always_on"
        description: "Should the slot be loaded at all times; Default false"
        type: "boolean"
      - name: "app_command_line"
        description: "App command line to launch e.g. /sbin/myserver -b 0.0.0.0"
        type: "string"
      - name: "auto_swap_slot_name"
        description: "The name of the slot to automatically swap to during deployment"
        type: "string"
      - name: "cors"
        description: "Cors Block"
        type: "block"
      - name: "default_documents"
        description: "The ordering of default documents to load, if an address isn't specified"
        type: "string"
      - name: "dotnet_framework_version"
        description: "The version of the .NET framework's CLR used in this App Service Slot; v2.0, v4.0, v5.0 or v6.0; Default v4.0"
        type: "string"
      - name: "ftps_state"
        description: "State of FTP / FTPS service for this App Service Slot; AllAllowed, FtpsOnly or Disabled"
        type: "string"
      - name: "health_check_path"
        description: "The health check path to be pinged by App Service Slot"
        type: "string"
      - name: "number_of_workers"
        description: "The scaled number of workers for per site scaling of this App Service Slot"
        type: "string"
      - name: "http2_enabled"
        description: "Is HTTP2 Enabled on this App Service; Default false"
        type: "boolean"
      - name: "ip_restriction"
        description: "A list of objects representing IP restrictions"
        type: "block"
      - name: "scm_use_main_ip_restriction"
        description: "IP security restrictions for scm to use main; Default false"
        type: "boolean"
      - name: "scm_ip_restriction"
        description: "A list of objects representing IP restrictions"
        type: "block"
      - name: "java_version"
        description: "The version of Java to use; 1.7, 1.8 or 11"
        type: "string"
      - name: "java_container"
        description: "The Java Container to use; JAVA, JETTY or TOMCAT"
        type: "string"
      - name: "java_container_version"
        description: "The version of the Java Container"
        type: "string"
      - name: "local_mysql_enabled"
        description: "Is MySQL in App Enabled?"
        type: "boolean"
      - name: "linux_fx_version"
        description: "Linux App Framework and version for the App Service Slot; DOCKER|<user/image:tag>, COMPOSE|${filebase64('compose.yml')} etc"
        type: "string"
      - name: "windows_fx_version"
        description: "The Windows Docker container image; DOCKER|<user/image:tag>"
        type: "string"
      - name: "managed_pipeline_mode"
        description: "The Managed Pipeline Mode; Integrated or Classic; Default Integrated"
        type: "string"
      - name: "min_tls_version"
        description: "The minimum supported TLS version for the app service; 1.0, 1.1 or 1.2; Default 1.2"
        type: "string"
      - name: "php_version"
        description: "The version of PHP to use in this App Service Slot; 5.5, 5.6, 7.0, 7.1, 7.2, 7.3 or 7.4"
        type: "string"
      - name: "python_version"
        description: "The version of Python to use in this App Service Slot"
        type: "string"
      - name: "remote_debugging_enabled"
        description: "Is Remote Debugging Enabled?; Default false"
        type: "boolean"
      - name: "remote_debugging_version"
        description: "Which version of Visual Studio should the Remote Debugged be compatible with?; VS2017 or VS2019"
        type: "boolean"
      - name: "scm_type"
        description: "The type of Source Control enabled for this App Service Slot; BitbucketGit, BitbucketHg, CodePlexGit etc"
        type: "string"
      - name: "use_32_bit_worker_process"
        description: "Should the App Service Slot run in 32 bit mode rather than 64 bit mode?"
        type: "boolean"
      - name: "vnet_route_all_enabled"
        description: "Should all outbound traffic to have Virtual Network Security Groups and User Defined Routes applied? Default false"
        type: "boolean"
      - name: "websockets_enabled"
        description: "Should WebSockets be enabled"
        type: "boolean"

blocks:
  - name: "cors"
    required: false
    description: "A Cors Block"
    required_vars:
      - name: "allowed_origins"
        description: "A list of origins which should be able to make cross-origin calls"
        type: "list"
    optional_vars:
      - name: "support_credentials"
        description: "Are credentials supported?"
        type: "string"
  - name: "auth_settings"
    required: false
    description: "An Auth Settings Block"
    required_vars:
      - name: "enabled"
        description: "Is Authentication enabled?"    
        type: "boolean"
    optional_vars:
      - name: "active_directory"    
        description: "A Active Directory Block"    
        type: "block"
      - name: "additional_login_params"
        description: "Login parameters to send to the OpenID Connect authorization endpoint when a user logs in"
        type: "string"
      - name: "allowed_external_redirect_urls"
        description: "External URLs that can be redirected to as part of logging in or logging out of the app"
        type: "string"
      - name: "default_provider"  
        description: "The default provider to use ; AzureActiveDirectory, Facebook, Google, MicrosoftAccount or Twitter"
        type: "string"
      - name: "facebook"   
        description: "A Facebook Block"  
        type: "block"
      - name: "google"   
        description: "A Google Block"  
        type: "block"
      - name: "issuer"   
        description: "Issuer URI"  
        type: "string"
      - name: "microsoft"   
        description: "A Microsoft Block"  
        type: "block"
      - name: "runtime_version"   
        description: "The runtime version of the Authentication/Authorization module"
        type: "string"
      - name: "token_refresh_extension_hours"
        description: "The number of hours after session token expiration that a session token can be used to call the token refresh API"
        type: "string"
      - name: "toke_store_enabled" 
        description: "If enabled the module will durably store platform-specific security tokens; Default false"
        type: "boolean"
      - name: "twitter"   
        description: "A Twitter Block"  
        type: "block"
      - name: "unauthenticated_client_action"
        description: "The action to take when an unauthenticated client attempts to access the app; AllowAnonymouse or RedirectToLoginPage"
        type: "string"
  - name: "active_directory"
    required: false
    parent_block: "auth_settings"
    description: "An Active Directory Block"
    required_vars:
      - name: "client_id"
        description: "The Client ID of this relying part application"                   
        type: "boolean"
    optional_vars:
      - name: "client_secret"
        description: "The Client Secret of this relying party application"
        type: "string"
      - name: "allowed_audiences"
        description: "Allowed audience values to consider when validating JWTs issued by Azure AD"
        type: "string"
  - name: "facebook"
    required: false
    parent_block: "auth_settings"
    description: "A Facebook Block"
    required_vars:
      - name: "app_id"
        description: "The App ID of the Facebook app used for login"                 
        type: "string"
      - name: "app_secret"
        description: "The App Secret of the FAcebook app"
        type: "string"
    optional_vars:
      - name: "oauth_scopes"
        description: "The OAuth 2.0 scopes that will be requested as part of Facebook login authentication"
        type: "string"
  - name: "twitter"
    required: false
    parent_block: "auth_settings"
    description: "An Twitter Block"
    required_vars:
      - name: "consumer_key"
        description: "The Consumer Key of the Twitter app used for login"               
        type: "string"
      - name: "consumer_secret"
        description: "The Consumer Secret of the Twitter app used for login"
        type: "string"
  - name: "google"
    required: false
    parent_block: "auth_settings"
    description: "A Google Block"
    required_vars:
      - name: "client_id"
        description: "The OpenID Connect Client ID for the Google wep app"
        type: "string"
      - name: "client_secret"
        description: "The Client Secret associated with the Google web app"
        type: "string"
    optional_vars:
      - name: "oauth_scopes"
        description: "The OAuth 2.0 scopes that will be requested as part of Google sign in authentication"
        type: "string"
  - name: "ip_restriction"
    required: false
    parent_block: "site_config"
    description: "An IP Restriction Block"
    optional_vars:
      - name: "ip_address"
        description: "The IP Address used for this IP Restriction in CIDR notation"
        type: "string"
      - name: "service_tag"
        description: "The Service Tag used for this IP Restriction"
        type: "string"
      - name: "virtual_network_subnet_id"
        description: "The Virtual Network Subnet ID used for this IP Restriction"
        type: "string"
      - name: "name"
        description: "The name for this IP Restriction"
        type: "string"
      - name: "priority"
        description: "The priority for this IP Restriction"
        type: "string"
      - name: "action"
        description: "Does this restriction Allow or Deny access for this IP range; Default Allow"
        type: "string"
      - name: "headers"
        description: "The headers block"
        type: "block"
  - name: "headers"
    required: false
    parent_block: "ip_restriction"
    description: "A Headers Block"
    optional_vars:
      - name: "x_azure_fdid"
        description: "A list of allowed Azure FrontDoor IDs in UUID notation; maximum of 8"
        type: "list"
      - name: "x_fd_health_probe"
        description: "A list to allow the Azure FrontDoor health probe header; only allowd value is '1'"
        type: "string"
      - name: "x_forwarded_for"
        description: "A list of allowed X-Forwarded-For IPs in CIDR notation; maximum of 8"
        type: "list"
      - name: "x_forwrded_host"
        description: "A list of allowed X-Forwarded-Host domains; maximum of 8"
        type: "list"
  - name: "scm_ip_restriction"
    required: false
    parent_block: "site_config"
    description: "An SCM IP Restriction Block"
    optional_vars:
      - name: "ip_address"
        description: "The IP Address used for this IP Restriction in CIDR notation"
        type: "string"
      - name: "service_tag"
        description: "The Service Tag used for this IP Restriction"
        type: "string"
      - name: "virtual_network_subnet_id"
        description: "The Virtual Network Subnet ID used for this IP Restriction"
        type: "string"
      - name: "name"
        description: "The name for this IP Restriction"
        type: "string"
      - name: "priority"
        description: "The priority for this IP Restriction"
        type: "string"
      - name: "action"
        description: "Does this restriction Allow or Deny access for this IP range; Default Allow"
        type: "string"
      - name: "headers"
        description: "The headers block"
        type: "block"
  - name: "headers"
    required: false
    parent_block: "scm_ip_restriction"
    description: "A Headers Block"
    optional_vars:
      - name: "x_azure_fdid"
        description: "A list of allowed Azure FrontDoor IDs in UUID notation; maximum of 8"
        type: "list"
      - name: "x_fd_health_probe"
        description: "A list to allow the Azure FrontDoor health probe header; only allowd value is '1'"
        type: "string"
      - name: "x_forwarded_for"
        description: "A list of allowed X-Forwarded-For IPs in CIDR notation; maximum of 8"
        type: "list"
      - name: "x_forwrded_host"
        description: "A list of allowed X-Forwarded-Host domains; maximum of 8"
        type: "list"
  - name: "microsoft"
    required: false
    parent_block: "auth_settings"
    description: "A Microsoft Block"
    required_vars:
      - name: "client_id"
        description: "The OAuth 2.0 Client ID that was created for the app used for authentication"
        type: "string"
      - name: "client_secret"
        description: "The OAuth 2.0 Client Secret that was created for the app used for authentication"
        type: "string"
    optional_vars:
      - name: "oauth_scopes"
        description: "The OAuth 2.0 scopes that will be requested as part of Microsoft Account Auth"
        type: "string"
  - name: "identity"
    required: false
    description: "An Identity Block"
    required_vars:
      - name: "type"
        description: "Specifies the identity type of the App Service; SystemAssigned or UserAssigned"
        type: "string"
    optional_vars:
      - name: "identity_ids"
        description: "Specifies a list of user managed identity ids to be assigned"
        type: "string"
  - name: "logs"
    required: false
    description: "A Logs Block"
    optional_vars:
      - name: "application_logs"
        description: "An application logs block"
        type: "block"
      - name: "http_logs"
        description: "An HTTP logs Block"
        type: "block"
      - name: "detailed_error_messages_enabled"
        description: "Should detailed error messages be enabled on this App Service Slot; Default false"
        type: "boolean"
      - name: "failed_request_tracing_enabled"
        description: "Should failed request tracing be enabled on this App Service Slot; Default false"
        type: "boolean"
  - name: "application_logs"
    required: false
    parent_block: "logs"
    description: "An Application Logs Block"
    optional_vars:
      - name: "file_system_level"
        description: "The file system log level; Off, Error, Warning, Information or Verbose"
        type: "string"
      - name: "azure_blob_storage"
        description: "An Azure Blob Storage Block"
        type: "block"
  - name: "http_logs"
    required: false
    parent_block: "logs"
    description: "A HTTP Logs Block"
    optional_vars:
      - name: "file_system"
        description: "A file system block"
        type: "block"
      - name: "azure_blob_storage"
        description: "An Azure Blob Storage Block"
        type: "block"
  - name: "azure_blob_storage"
    required: false
    parent_block: "application_logs"
    description: "An Azure Blob Storage Logs Block"
    required_vars:
      - name: "level"
        description: "The level at which to log; Error, Warning, Information, Verbose or Off"
        type: "string"
      - name: "sas_url"
        description: "The URL to the storage container with a Service SAS token appended"
        type: "string"
      - name: "retention_in_days"
        description: "The number of days to retain logs for"
        type: "string"
  - name: "azure_blob_storage"
    required: false
    parent_block: "http_logs"
    description: "An Azure Blob Storage Logs Block"
    required_vars:
      - name: "level"
        description: "The level at which to log; Error, Warning, Information, Verbose or Off"
        type: "string"    
      - name: "sas_url"
        description: "The URL to the storage container with a Service SAS token appended"
        type: "string"
      - name: "retention_in_days"
        description: "The number of days to retain logs for"
        type: "string"
  - name: "file_system"
    required: false
    parent_block: "http_logs"
    description: "A File System Block"
    required_vars:
      - name: "retention_in_mb"
        description: "The maximum size in megabytes that HTTP log files can use before being removed"
        type: "string"
      - name: "retention_in_days"
        description: "The number of days to retain logs for"
        type: "string"
