resource:
  name: "azurerm_api_management"
  enable_variable_comments: false
  var_name: "api_management"
  required_vars:
    - name: "name"
      description: "The name of the API Management Service"
      type: "string"
    - name: "location"
      description: "The Azure location where the API Management Service exists"
      type: "string"
    - name: "resource_group_name"
      description: "The name of the resource group where the API Management Service is created"
      type: "string"
    - name: "publisher_name"
      description: "The name of the publisher / company"
      type: "string"
    - name: "publisher_email"
      description: "The email of the publisher / company"
      type: "string"
    - name: "sku_name"
      description: "The sku name <type>_<capacity> e.g. Developer_1; Consumption, Developer, Basic, Standard, Premium"
      type: "string"
  optional_vars:
    - name: "client_certificate_enabled"
      description: "Enforce clients to present a client certificate"
      type: "boolean"
    - name: "gateway_disabled"
      description: "Disabled the gateway in the main region"
      type: "boolean"
    - name: "min_api_version"
      description: "The minimum accepted API version"
      type: "string"
    - name: "zones"
      description: "A list of availability zones"
      type: "list"
    - name: "notification_sender_email"
      description: "Email address the notification appears FROM"
      type: "string"
    - name: "public_ip_address_id"
      description: "ID of a standard SKU IPv4 Public IP"
      type: "string"

blocks:
  - name: "additional_location"
    required: false 
    description: "An additional location block"
    required_vars:
      - name: "location"
        description: "Azure Region to expand the API Management Service into"
        type: "string"
    optional_vars:
      - name: "capacity"
        description: "Number of compute units in this region"
        type: "string"
      - name: "zone"
        description: "List of availability zones"
        type: "list"
      - name: "public_ip_address_id"
        description: "ID of a standard SKU IPv4 Public IP"
        type: "string"
      - name: "virtual_network_configuration"
        description: "Virtual network config block"
        type: "block"
      - name: "gateway_disabled"
        description: "Disable the gateway in this location"
        type: "boolean"
  - name: "certificate"
    required: false
    description: "A Certificate block"
    required_vars:
      - name: "encoded_certificate"
        description: "The Base64 Encoded PFX or Base64 Encoded X.509 Certificate"
        type: "string"
      - name: "store_name"
        description: "The name of the Certificate Store where this certificate should be stored; CertificateAuthority or Root"
        type: "string"
    optional_vars:
      - name: "certificate_password"
        description: "The password for the certificate"
        type: "string"
  - name: "delegation"
    required: false
    description: "Delegation Block"
    optional_vars:
      - name: "subscriptions_enabled"
        description: "Delegate subscription requests to an external url; Default false"
        type: "boolean"
      - name: "user_registration_enabled"
        description: "Should user registration requests be delegated to an external url; Default false"
        type: "boolean"
      - name: "url"
        description: "Delegation URL"
        type: "string"
      - name: "validation_key"
        description: "A base64-encoded validation key to vaidate the request originates from Azure API Management"
        type: "string"
  - name: "identity"
    required: false
    description: "Managed Identity block"
    required_vars:
      - name: "type"
        description: "Specifies the type of Managed Serviec Identity to use with API Management Service; SystemAssigned or UserAssigned"
        type: "string"
    optional_vars:
      - name: "identity_ids"
        description: "A list of User Assigned Managed Identity IDs"
        type: "list"
  - name: "hostname_configuration"
    required: false
    description: "Hostname configuration block"
    optional_vars:
      - name: "management"
        description: "Management block"
        type: "block"
      - name: "portal"
        description: "Portal Block"
        type: "block"
      - name: "developer_portal"
        description: "Developer Portal Block"
        type: "block"
      - name: "proxy"
        description: "Proxy Block"
        type: "block"
      - name: "scm"
        description: "SCM Block"
        type: "block"
  - name: "management"
    required: false
    parent_block: "hostname_configuration"
    description: "Management block"
    required_vars:
      - name: "host_name"
        description: "The Hostname to use for the Management API"
        type: "string"
    optional_vars:
      - name: "key_vault_id"
        description: "The ID of the Key Vault Secret containing the SSL Certificate"
        type: "string"
      - name: "certificate"
        description: "The Base64 Encoded Certificate"
        type: "string"
      - name: "certificate_password"
        description: "The password associatd with the certificate"
        type: "string"
      - name: "negotiate_client_certificate"
        description: "Should Client Certificate Negotiation be enabled"
        type: "boolean"
      - name: "ssl_keyvault_identity_client_id"
        description: "System or User Assigned Managed IDentity clientId"
        type: "string"
  - name: "portal"
    required: false
    parent_block: "hostname_configuration"
    description: "Portal block"
    required_vars:
      - name: "host_name"
        description: "The Hostname to use for the Management API"
        type: "string"
    optional_vars:
      - name: "key_vault_id"
        description: "The ID of the Key Vault Secret containing the SSL Certificate"
        type: "string"
      - name: "certificate"
        description: "The Base64 Encoded Certificate"
        type: "string"
      - name: "certificate_password"
        description: "The password associatd with the certificate"
        type: "string"
      - name: "negotiate_client_certificate"
        description: "Should Client Certificate Negotiation be enabled"
        type: "boolean"
      - name: "ssl_keyvault_identity_client_id"
        description: "System or User Assigned Managed IDentity clientId"
        type: "string"
  - name: "developer_portal"
    required: false
    parent_block: "hostname_configuration"
    description: "Developer Portal block"
    required_vars:
      - name: "host_name"
        description: "The Hostname to use for the Management API"
        type: "string"
    optional_vars:
      - name: "key_vault_id"
        description: "The ID of the Key Vault Secret containing the SSL Certificate"
        type: "string"
      - name: "certificate"
        description: "The Base64 Encoded Certificate"
        type: "string"
      - name: "certificate_password"
        description: "The password associatd with the certificate"
        type: "string"
      - name: "negotiate_client_certificate"
        description: "Should Client Certificate Negotiation be enabled"
        type: "boolean"
      - name: "ssl_keyvault_identity_client_id"
        description: "System or User Assigned Managed IDentity clientId"
        type: "string"
  - name: "scm"
    required: false
    parent_block: "hostname_configuration"
    description: "SCM block"
    required_vars:
      - name: "host_name"
        description: "The Hostname to use for the Management API"
        type: "string"
    optional_vars:
      - name: "key_vault_id"
        description: "The ID of the Key Vault Secret containing the SSL Certificate"
        type: "string"
      - name: "certificate"
        description: "The Base64 Encoded Certificate"
        type: "string"
      - name: "certificate_password"
        description: "The password associatd with the certificate"
        type: "string"
      - name: "negotiate_client_certificate"
        description: "Should Client Certificate Negotiation be enabled"
        type: "boolean"
      - name: "ssl_keyvault_identity_client_id"
        description: "System or User Assigned Managed IDentity clientId"
        type: "string"
  - name: "policy"
    required: false
    description: "Policy block"
    optional_vars:
      - name: "xml_content"
        description: "The XML Content for this Policy"
        type: "string"
      - name: "xml_link"
        description: "A link to an API Management Policy XML Document"
        type: "string"
  - name: "proxy"
    required: false
    parent_block: "hostname_configuration"
    description: "Proxy block"
    required_vars:
      - name: "host_name"
        description: "The Hostname to use for the Management API"
        type: "string"
    optional_vars:
      - name: "default_ssl_binding"
        description: "Is the certificate associated with this Hostname the Default SSL Certificate; Default false"
        type: "boolean"
      - name: "key_vault_id"
        description: "The ID of the Key Vault Secret containing the SSL Certificate"
        type: "string"
      - name: "certificate"
        description: "The Base64 Encoded Certificate"
        type: "string"
      - name: "certificate_password"
        description: "The password associatd with the certificate"
        type: "string"
      - name: "negotiate_client_certificate"
        description: "Should Client Certificate Negotiation be enabled"
        type: "boolean"
      - name: "ssl_keyvault_identity_client_id"
        description: "System or User Assigned Managed IDentity clientId"
        type: "string"
  - name: "protocols"
    required: false
    description: "Protocol block"
    optional_vars:
      - name: "enable_http2"
        description: "Should HTTP/2 be support by the API Management Service; Default false"
        type: "boolean"
  - name: "security"
    required: false
    description: "Security block"
    optional_vars:
      - name: "enable_backend_ssl30"
        description: "Enable SSL 3.0 on the backend; Default false"
        type: "boolean"
      - name: "enable_backend_tls10"
        description: "Enable TLS 1.0 on the backend; Default false"
        type: "boolean"
      - name: "enable_backend_tls11"
        description: "Enable TLS 1.1 on the backend; Default false"
        type: "boolean"
      - name: "enable_frontend_ssl30"
        description: "Enable SSL 3.0 on the frontend; Default false"
        type: "boolean"
      - name: "enable_frontend_tls10"
        description: "Enable TLS 1.0 on the frontend; Default false"
        type: "boolean"
      - name: "tls_ecdhe_ecdsa_with_aes128_cbc_sha_ciphers_enabled"
        description: "Enable cipher tls_ecdhe_ecdsa_with_aes128_cbc_sha_ciphers; Default false"
        type: "boolean"
      - name: "tls_ecdhe_ecdsa_with_aes256_cbc_sha_ciphers_enabled"
        description: "Enable cipher tls_ecdhe_ecdsa_with_aes256_cbc_sha_ciphers; Default false"
        type: "boolean"
      - name: "tls_ecdhe_rsa_with_aes128_cbc_sha_ciphers_enabled"
        description: "Enable cipher tls_ecdhe_rsa_with_aes128_cbc_sha_ciphers; Default false"
        type: "boolean"
      - name: "tls_ecdhe_rsa_with_aes256_cbc_sha_ciphers_enabled"
        description: "Enable cipher tls_ecdhe_rsa_with_aes256_cbc_sha_ciphers; Default false"
        type: "boolean"
      - name: "tls_rsa_with_aes128_cbc_sha256_ciphers_enabled"
        description: "Enable cipher tls_rsa_with_aes128_cbc_sha256_ciphers; Default false"
        type: "boolean"
      - name: "tls_rsa_with_aes128_cbc_sha_ciphers_enabled"
        description: "Enable cipher tls_rsa_with_aes128_cbc_sha_ciphers; Default false"
        type: "boolean"
      - name: "tls_rsa_with_aes128_gcm_sha256_ciphers_enabled"
        description: "Enable cipher tls_rsa_with_aes128_gcm_sha256_ciphers; Default false"
        type: "boolean"
      - name: "tls_rsa_with_aes256_gcm_sha384_ciphers_enabled"
        description: "Enable cipher tls_rsa_with_aes256_gcm_sha384_ciphers; Default false"
        type: "boolean"
      - name: "tls_rsa_with_aes256_cbc_sha256_ciphers_enabled"
        description: "Enable cipher tls_rsa_with_aes256_cbc_sha256_ciphers; Default false"
        type: "boolean"
      - name: "tls_rsa_with_aes256_cbc_sha_ciphers_enabled"
        description: "Enable cipher tls_rsa_with_aes256_cbc_sha_ciphers; Default false"
        type: "boolean"
      - name: "triple_des_ciphers_enabled"
        description: "Enable cipher triple_des_ciphers_enabled; Default false"
        type: "boolean"
  - name: "sign_in"
    required: false
    description: "Sign in block"
    required_vars:
      - name: "enabled"
        description: "Should anonymous users be redirected to the sign in page"
        type: "boolean"
  - name: "sign_up"
    required: false
    description: "Sign up block"
    required_vars:  
      - name: "enabled"
        description: "Can users sign up on the development portal"
        type: "boolean"
      - name: "terms_of_service"
        description: "Terms of service block"
        type: "block"
  - name: "tenant_access"
    required: false
    description: "Tenant access block"
    required_vars:  
      - name: "enabled"
        description: "Should access to the management API be enabled"
        type: "boolean"
  - name: "virtual_network_configuration"
    required: false
    description: "Virtual Network Block"
    required_vars:  
      - name: "subnet_id"
        description: "The id of the subnet that will be used for the API Management"
        type: "string"
  - name: "terms_of_service"
    required: false
    parent_block: "sign_up"
    description: "Terms of service block"
    required_vars:  
      - name: "consent_required"
        description: "Should the user be asked for consent during sign up"
        type: "boolean"
      - name: "enabled"
        description: "Should the TOS be displayed during sign up"
        type: "boolean"
    optional_vars:
      - name: "text"
        description: "The Terms of Service which users are required to agree"
        type: "string"
