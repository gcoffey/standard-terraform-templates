resource:
  name: "azurerm_app_service"
  enable_variable_comments: false
  var_name: "app_service"
  required_vars:
    - name: "name"
      description: "The name of the App Service"
      type: "string"
    - name: "location"
      description: "The Azure location where to create the resource"
      type: "string"
    - name: "resource_group_name"
      description: "The name of the resource group where to create the App Service"
      type: "string"
    - name: "app_service_plan_id"
      description: "The ID of the App Service Plan"
      type: "string"
  optional_vars:
    - name: "app_settings"
      description: "An App Settings Block"
      type: "block"
    - name: "auth_settings"
      description: "An Auth Settings Block"
      type: "block"
    - name: "backup"
      description: "A Backup Block"
      type: "block"
    - name: "connection_string"
      description: "A connection string block"
      type: "block"
    - name: "client_cert_enabled"
      description: "Does the App Service require a client to present a certificate; Default false"
      type: "boolean"
    - name: "enabled"
      description: "Is the App Service enabled"
      type: "boolean"
    - name: "identity"
      description: "An Identity Block"
      type: "block"
    - name: "https_only"
      description: "Can the App Service be access only using HTTPS; Default false"
      type: "boolean"
    - name: "key_vault_reference_identity_id"
      description: "The User Assigned Identity Id used for looking up Key Vault secrets"
      type: "string"
    - name: "logs"
      description: "A logs block"
      type: "block"
    - name: "storage_account"
      description: "A storage account block"
      type: "block"
    - name: "site_config"
      description: "A site config block"
      type: "block"
    - name: "source_control"
      description: "A source control block"
      type: "block"
    - name: "tags"
      description: "A mapping of tags"
      type: "list"

blocks:
  - name: "app_settings"
    required: false 
    description: "App Settings block"
    optional_vars:
      - name: "SOME_KEY"
        description: "Specify any application key / values your App requires"
        type: "string"
      - name: "ANOTHER_KEY"
        description: "Specify any application key / values your App requires"
        type: "string"
  - name: "storage_account"
    required: false
    description: "A Storage Account block"
    required_vars:
      - name: "name"
        description: "The name of the storage account identifier"
        type: "string"
      - name: "type"
        description: "The type of storage; AzureBlob or AzureFiles"
        type: "string"
      - name: "account_name"
        description: "The name of the storage account"
        type: "string"
      - name: "share_name"
        description: "The name of the file share (container name when type = AzureBlob)"
        type: "string"
      - name: "access_key"
        description: "The path to mount the storage within the site's runtime environment"
        type: "string"
    optional_vars:
      - name: "mount_path"
        description: "The path to mount the storage within the site's runtime environment"
        type: "string"
  - name: "connection_string"
    required: false
    description: "A Connection String block"
    required_vars:
      - name: "name"
        description: "The name of the connection string"
        type: "string"
      - name: "type"
        description: "The type of connection string; APIHub, Custom, DocDb, EventHub, MySQL, NotificationHub, PostgreSQL, RedisCache etc"
        type: "string"
      - name: "value"
        description: "The value for the Connection String"
        type: "string"
  - name: "identity"
    required: false
    description: "An Identity block"
    required_vars:
      - name: "type"
        description: "The Identity type of the App Service; SystemAssigned or UserAssigned"
        type: "string"
    optional_vars:
      - name: "identity_ids"
        description: "Specifies a list of user managed identity ids; Required if type = UserAssigned"
        type: "string"
  - name: "logs"
    required: false
    description: "A Logs block"
    optional_vars:
      - name: "application_logs"
        description: "An application logs block"
        type: "block"
      - name: "http_logs"
        description: "A http logs block"
        type: "block"
      - name: "detailed_error_messages_enabled"
        description: "Should detailed error message be enabled; Default false"
        type: "boolean"
      - name: "failed_request_tracing_enabled"
        description: "Should failed request tracing be enabled; Default false"
        type: "boolean"
  - name: "application_logs"
    required: false
    parent_block: "logs"
    description: "An Application Logs block"
    optional_vars:
      - name: "azure_blob_storage"
        description: "An Azure Blob Storage Block"
        type: "block"
      - name: "file_system_level"
        description: "Log level for filesystem based logging; Error, Information, Verbose, Warning or Off; Default Off"
        type: "string"
  - name: "http_logs"
    required: false
    parent_block: "logs"
    description: "A HTTP Logs block"
    optional_vars:
      - name: "file_system"
        description: "A file system block"
        type: "block"
      - name: "azure_blob_storage"
        description: "An Azure Blob Storage block"
        type: "block"
  - name: "azure_blob_storage"
    required: false
    parent_block: "application_logs"
    description: "A Azure Blob Storage block"
    required_vars:
      - name: "level"
        description: "The log level; Error, Warning, Information, Verbose or Off"
        type: "string"
      - name: "sas_url"
        description: "The URL to the storage container with a shared access signature token appended"
        type: "string"
      - name: "retention_in_days"
        description: "The number of days to retain logs for"
        type: "string"
  - name: "azure_blob_storage"
    required: false
    parent_block: "http_logs"
    description: "A Azure Blob Storage block"
    required_vars:
      - name: "sas_url"
        description: "The URL to the storage container with a shared access signature token appended"
        type: "string"
      - name: "retention_in_days"
        description: "The number of days to retain logs for"
        type: "string"
  - name: "file_system"
    required: false
    parent_block: "http_logs"
    description: "A File System Block"
    required_vars:
      - name: "retention_in_mb"
        description: "The maximum size in megabytes that HTTP log files can use before being removed"
        type: "string"
      - name: "retention_in_days"
        description: "The number of days to retain logs for"
        type: "string"
  - name: "site_config"
    required: false
    description: "A Site Config block"
    optional_vars:
      - name: "acr_user_managed_identity_credentials"
        description: "Are Managed Identity Credentials use for Azure Container Registry pull?; true, false"
        type: "boolean"
      - name: "acr_user_managed_identity_client_id"
        description: "If using User Managed Identity, the User Managed Identity Client Id"
        type: "string"
      - name: "always_on"
        description: "Should the app be loaded at all times?; Default false"
        type: "boolean"
      - name: "app_command_line"
        description: "App command line to launch e.g. /sbin/myserver -b 0.0.0.0"
        type: "string"
      - name: "auto_swap_slot_name"
        description: "The name of the slot to automatically swap to during deployment"
        type: "string"
      - name: "cors"
        description: "A Cors Block" 
        type: "string"
      - name: "default_documents"
        description: "The ordering of default documents to load, if an address isn't specified"
        type: "string"
      - name: "dotnet_framework_version"
        description: "The version of the .NET framework CLR used in this App Service; v2.0, v4.0, v5.0 or v6.0; Default v4.0"
        type: "string"
      - name: "ftps_state"
        description: "State of the FTP / FTPS service for this App Service; AllAllowed, FtpsOnly or Disabled"
        type: "string"
      - name: "health_check_path"
        description: "The health check path to be pinged by App Service"
        type: "string"
      - name: "number_of_workers"
        description: "The scaled number of workers (for per site scaling) of this App Service"
        type: "string"
      - name: "http2_enabled"
        description: "Is HTTP2 Enabled on this App Service?; Default false"
        type: "boolean"
      - name: "ip_restriction"
        description: "An IP Restriction block"
        type: "block"
      - name: "scm_use_main_ip_restriction"
        description: "IP security restrictions for scm to use main; Default false"
        type: "boolean"
      - name: "scm_ip_restriction"
        description: "An SCM IP Restriction block"
        type: "block"
      - name: "java_version"
        description: "The version of Java to use; 1.7, 1.8, 11"
        type: "string"
      - name: "java_container"
        description: "The Java Container to use; JAVA, JETTY or TOMCAT"
        type: "string"
      - name: "java_container_version"
        description: "The version of the Java Container to use"
        type: "string"
      - name: "local_mysql_enabled"
        description: "Is MySQL In App Enabled?"
        type: "boolean"
      - name: "linux_fx_version"
        description: "Linux App Framework and version for the App Service; DOCKER|<user/image:tag>, COMPOSE|${filebase64('compose.yml')} etc"
        type: "string"
      - name: "windows_fx_version"
        description: "The Windows Docker container image; DOCKER|<user/image:tag>"
        type: "string"
      - name: "managed_pipeline_mode"
        description: "The managed pipeline mode; Integrated or Classic; Default Integrated"
        type: "string"
      - name: "min_tls_version"
        description: "The minimum supported TLS vesion for the App Service; 1.0, 1.1 or 1.2; Default 1.2"
        type: "string"
      - name: "php_version"
        description: "The version of PHP to use in this App Service; 5.5, 5.6, 7.0, 7.1, 7.2, 7.3 or 7.4"
        type: "string"
      - name: "python_version"
        description: "The version of Python to use in this App Service; 2.7 or 3.4"
        type: "string"
      - name: "remote_debugging_enabled"
        description: "Is Remote Debugging Enabled?; Default false"
        type: "boolean"
      - name: "remote_debugging_version"
        description: "Which version of Visual Studio should the Remote Debugged be compatible with?; VS2017 or VS2019"
        type: "string"
      - name: "scm_type"
        description: "The type of Source Control enabled for this App Service; BitbucketGit, BitbucketHg, CodePlexGit, CodePlexHg, Dropbox, ExternalGit etc"
        type: "string"
      - name: "use_32_bit_worker_process"
        description: "Should the App Service run in 32 bit mode rather than 64 bit mode?"
        type: "string"
      - name: "vnet_route_all_enabled"
        description: "Should all outbound traffic to have Virtual Network Security Groups and User Defined Routes Applied? Default false"
        type: "boolean"
      - name: "websockets_enabled"
        description: "Should websockets be enabled?"
        type: "boolean"
  - name: "cors"
    required: false
    parent_block: "site_config"
    description: "A Cors Block"
    required_vars:
      - name: "allowed_origins"
        description: "A list of origins which should be able to make cross-origin calls"
        type: "list"
    optional_vars:
      - name: "support_credentials"
        description: "Are credentials supported?"
        type: "string"
  - name: "auth_settings"
    required: false
    description: "An Auth Settings Block"
    required_vars:
      - name: "enabled"
        description: "Is Authentication enabled?"
        type: "boolean"
    optional_vars:
      - name: "active_directory"
        description: "An Active Directory block"
        type: "block"
      - name: "additional_login_params"
        description: "Login parameters to send to the OpenID Connect authorization endpoint when a user logs in"
        type: "string"
      - name: "allowed_external_redirect_urls"
        description: "External URLs that can be redirected to as part of logging in or logging out of the app"
        type: "string"
      - name: "default_provider"
        description: "The default provider to use when multiple provides have been setup; AzureActiveDirectory, Facebook, Google etc"
        type: "string"
      - name: "facebook"
        description: "A facebook block"
        type: "block"
      - name: "google"
        description: "A google block"
        type: "block"
      - name: "issuer"
        description: "Issuer URI"
        type: "string"
      - name: "microsoft"
        description: "An Microsoft block"
        type: "block"
      - name: "runtime_version"
        description: "The runtime version of the Authentication / Authorization module"
        type: "string"
      - name: "token_refresh_extension_hours"
        description: "The number of hours after session token expiration that a session token can be used to call the token Refresh API"
        type: "string"
      - name: "token_store_enabled"
        description: "If enabled the module will durably store platform-specifc security tokens that are obtained during login flows"
        type: "boolean"
      - name: "twitter"
        description: "A twitter block"
        type: "block"
      - name: "unauthenticated_client_action"
        description: "The action to take when an unauthenticated client attempts to access the app; AllowAnonymous or RedirectToLoginPage"
        type: "string"
  - name: "active_directory"
    required: false
    parent_block: "auth_settings"
    description: "An Active Directory block"
    required_vars:
      - name: "client_id"
        description: "The Client ID of this relying part application"
        type: "string"
    optional_vars:
      - name: "client_secret"
        description: "The Client Secret of this relying party application"
        type: "string"
      - name: "allowed_audiences"
        description: "Allowed audience values to consider when validating JWTs issued by Azure Active Directory"
        type: "string"
  - name: "facebook"
    required: false
    parent_block: "auth_settings"
    description: "A facebook block"
    required_vars:
      - name: "app_id"
        description: "The App ID of the Facebook app used for login"
        type: "string"
      - name: "app_secret"
        description: "The App Secret of the Facebook app used for login"
        type: "string"
    optional_vars:
      - name: "oauth_scopes"
        description: "The OAuth 2.0 scopes that will be requested as part of Facebook login authentication"
        type: "string"
  - name: "google"
    required: false
    parent_block: "auth_settings"
    description: "A Google Block"
    required_vars:
      - name: "client_id"
        description: "The OpenID Connect Client ID for the Google Web App"
        type: "string"
      - name: "client_secret"
        description: "The client secret associated with the Google Web App"
        type: "string"
    optional_vars:
      - name: "oauth_scopes"
        description: "The OAuth 2.0 scopes that will be requested as part of Google login authentication"
        type: "string"
  - name: "twitter"
    required: false
    parent_block: "auth_settings"
    description: "A twitter block"
    required_vars:
      - name: "consumer_key"
        description: "The consumer key of the Twitter app used for login"
        type: "string"
      - name: "consumer_secret"
        description: "The consumer secret of the Twitter app used for login"
        type: "string"
  - name: "ip_restriction"
    required: false
    parent_block: "site_config"
    description: "An IP Restriction Block"
    optional_vars:
      - name: "ip_address"
        description: "The IP Address used for this IP Restriction in CIDR notation"
        type: "string"
      - name: "service_tag"
        description: "The Service Tag used for this IP Restriction"
        type: "string"
      - name: "virtual_network_subnet_id"
        description: "The Virtual Network Subnet ID used for this IP restriction"
        type: "string"
      - name: "name"
        description: "The Name of this IP restriction"
        type: "string"
      - name: "priority"
        description: "The priority for this IP Restriction"
        type: "string"
      - name: "action"
        description: "Does this restriction Allow or Deny access for this IP range; Default Allow"
        type: "string"
      - name: "headers"
        description: "A header block"
        type: "block"
  - name: "scm_ip_restriction"
    required: false
    parent_block: "site_config"
    description: "An SCM IP Restriction Block"
    optional_vars:
      - name: "ip_address"
        description: "The IP Address used for this IP Restriction in CIDR notation"
        type: "string"
      - name: "service_tag"
        description: "The Service Tag used for this IP Restriction"
        type: "string"
      - name: "virtual_network_subnet_id"
        description: "The Virtual Network Subnet ID used for this IP restriction"
        type: "string"
      - name: "name"
        description: "The Name of this IP restriction"
        type: "string"
      - name: "priority"
        description: "The priority for this IP Restriction"
        type: "string"
      - name: "action"
        description: "Does this restriction Allow or Deny access for this IP range; Default Allow"
        type: "string"
      - name: "headers"
        description: "A header block"
        type: "block"
  - name: "headers"
    required: false
    parent_block: "ip_restriction"
    description: "A headers Block"
    optional_vars:
      - name: "x_azure_fdid"
        description: "A list of allowed Azure FrontDoor IDs in UUID notation; maximum of 8"
        type: "list"
      - name: "x_fd_health_probe"
        description: "A list to allow the Azure FrontDoor health probe header; Only allowed value is 1"
        type: "string"
      - name: "x_forwarded_for"
        description: "A list of allowed X-Forwarded-For IPs in CIDR notation; maximum of 8"
        type: "list"
      - name: "x_forwarded_host"
        description: "A list of allowed X-Forwarded-Host domains; maximum of 8"
        type: "string"
  - name: "headers"
    required: false
    parent_block: "scm_ip_restriction"
    description: "A headers Block"
    optional_vars:      
      - name: "x_azure_fdid"
        description: "A list of allowed Azure FrontDoor IDs in UUID notation; maximum of 8"
        type: "list"
      - name: "x_fd_health_probe"
        description: "A list to allow the Azure FrontDoor health probe header; Only allowed value is 1"
        type: "string"
      - name: "x_forwarded_for"
        description: "A list of allowed X-Forwarded-For IPs in CIDR notation; maximum of 8"
        type: "list"
      - name: "x_forwarded_host"
        description: "A list of allowed X-Forwarded-Host domains; maximum of 8"
        type: "string"
  - name: "microsoft"
    required: false
    parent_block: "auth_settings"
    description: "A Microsoft Block"
    required_vars:
      - name: "client_id"
        description: "The OpenID Connect Client ID for the App"
        type: "string"
      - name: "client_secret"
        description: "The client secret associated with the App"
        type: "string"
    optional_vars:
      - name: "oauth_scopes"
        description: "The OAuth 2.0 scopes that will be requested as part of Microsoft Account authentication"
        type: "string"
  - name: "backup"
    required: false
    description: "A Backup Block"
    required_vars:
      - name: "name"
        description: "The name for this backup"
        type: "string"
      - name: "storage_account_url"
        description: "The SAS URL to a Storage Container where Backups should be saved"
        type: "string"
      - name: "schedule"
        description: "A schedule block"
        type: "block"
    optional_vars:
      - name: "enabled"
        description: "Is this backup enabled?; Default true"
        type: "boolean"
  - name: "schedule"
    required: false
    description: "A Schedule Block"
    required_vars:
      - name: "frequency_interval"
        description: "Sets how often the backup should be executed"
        type: "string"
      - name: "frequency_unit"
        description: "Sets the unite of time for how often the backup should be executed; Day or Hour"
        type: "string"
    optional_vars:
      - name: "keep_at_least_one_backup"
        description: "Should at least one backup always be kept in the Storage Account by the Retention Policy"
        type: "boolean"
      - name: "retention_period_in_days"
        description: "Specifies the number of days after which Backups should be delete; Default 30"
        type: "string"
      - name: "start_time"
        description: "Sets when the schedule should start working"
        type: "string"
  - name: "source_control"
    required: false
    description: "A Source Control Block"
    optional_vars:
      - name: "repo_url"
        description: "The URL of the source code repository"
        type: "string"
      - name: "branch"
        description: "The branch of the remote repository to use; Default master"
        type: "string"
      - name: "manual_integration"
        description: "Limits to manual integration; Default false"
        type: "string"
      - name: "rollback_enabled"
        description: "Enable roll-back for the repository; Default false"
        type: "boolean"
      - name: "use_mercurial"
        description: "Use mercurial if true, otherwise uses Git"
        type: "boolean"
