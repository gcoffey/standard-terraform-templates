resource:
  name: "azurerm_function_app"
  enable_variable_comments: false
  var_name: "app_function_app"
  required_vars:
    - name: "name"
      description: "Specifies the name of the Function App; must be 32 chars or less"
      type: "string"
    - name: "resource_group_name"
      description: "The name of the resource group in which to create the Function App"
      type: "string"
    - name: "location"
      description: "Specifies the supported Azure location where the resource should be created"
      type: "string"
    - name: "app_service_plan_id"
      description: "The ID of the App Service Plan within which to create this Function App"
      type: "string"
  optional_vars:
    - name: "app_settings"
      description: "A map of key-valu pairs for App Settings"
      type: "block"
    - name: "auth_settings"
      description: "An Auth Settings block"
      type: "block"
    - name: "connection_string"
      description: "A Connection String Block"
      type: "block"
    - name: "client_cert_mode"
      description: "Does a client need to present a client cert; Required or Optional"
      type: "string"
    - name: "daily_memory_time_quota"
      description: "The amount of memory in gb/seconds that your application is allowed to consume per day"
      type: "string"
    - name: "enabled"
      description: "Is the Function App enabled; Default true"
      type: "boolean"
    - name: "enable_builtin_logging"
      description: "Should the built-in logging of this Function App be enabled; Default true"
      type: "boolean"
    - name: "https_only"
      description: "Can the Function App only be accessed via HTTPS; Default false"
      type: "boolean"
    - name: "identity"
      description: "An Identity block"
      type: "block"
    - name: "key_vault_reference_identity_id"
      description: "The User Assigned Identity Id used for looking up KeyVault Secrets"
      type: "string"
    - name: "os_type"
      description: "A string indicating the Operating System type for this function app; linux or an empty string"
      type: "string"
    - name: "site_config"
      description: "A Site Config block"
      type: "block"
    - name: "source_control"
      description: "A Source Control Block"
      type: "block"
    - name: "storage_account_name"
      description: "The backend storage account name"
      type: "string"
    - name: "storage_account_access_key"
      description: "The access key which will be used to access the backend storage account"
      type: "string"
    - name: "version"
      description: "The runtime version associated with the Function App; Default ~1"
      type: "string"
    - name: "tags"
      description: "A mapping of tags"
      type: "list"

blocks:
  - name: "connection_string"
    required: false 
    description: "A Connection String Block"
    required_vars:
      - name: "name"
        description: "The name of the Connection String"
        type: "string"
      - name: "type"
        description: "The type of the Connection String; APIHub, Custom, DocDb, EventHub, MySQL, NotiicationHub etc"
        type: "string"
      - name: "value"
        description: "The value for the Connection String"
        type: "string"
  - name: "site_config"
    required: false 
    description: "A Site Config Block"
    optional_vars:
      - name: "always_on"
        description: "Should the Function App be loaded at all times; Default false"
        type: "boolean"
      - name: "app_scale_limit"
        description: "The number of workers this function app can scale out to"
        type: "string"
      - name: "cors"
        description: "A Cors Block"
        type: "block"
      - name: "dotnet_framework_version"
        description: "The version of the .NET framework's CLR used in this function app; v4.0, v5.0 or v6.0; Default v4.0"
        type: "string"
      - name: "elastic_instance_minimum"
        description: "The number of minimum instances for this function app"
        type: "string"
      - name: "ftps_state"
        description: "State of FTP / FTPS service for this function app; AllAllowed, FtpsOnly or Disabled; Default AllAllowed"
        type: "string"
      - name: "health_check_path"
        description: "Path which will be checked for this function app health"
        type: "string"
      - name: "http2_enabled"
        description: "Specifies whether or not the HTTP2 protocol should be enabled; Default false"
        type: "boolean"
      - name: "ip_restriction"
        description: "An IP Restriction block"
        type: "block"
      - name: "java_version"
        description: "Java version hosted by the function app; 1.8, 11 or 17"
        type: "string"
      - name: "linux_fx_version"
        description: "Linux App Framework and version for the App Service e.g. DOCKER|(golang:latest)"
        type: "string"
      - name: "min_tls_version"
        description: "The minimum supported TLS version; 1.0, 1.1 or 1.2; Default 1.2"
        type: "string"
      - name: "pre_warmed_instance_count"
        description: "The number of pre-warmed instances for this function app"
        type: "string"
      - name: "runtime_scale_monitoring_enabled"
        description: "Should Runtime SCale Monitoring be enabled; Default false"
        type: "boolean"
      - name: "scm_ip_restriction"
        description: "An SCM IP Restriction Block"
        type: "block"
      - name: "scm_type"
        description: "The type of source control used by the function app; BitBucketGit, BitBucketHg, CodePlexGit, CodePlexHg etc"
        type: "string"
      - name: "scm_use_main_ip_restriction"
        description: "IP Security restrictions for scm to use main ... ?; Default false"
        type: "boolean"
      - name: "use_32_bit_worker_process"
        description: "Should the Function App run in 32 bit mode; Default true"
        type: "boolean"
      - name: "vnet_route_all_enabled"
        description: "Should all outbound traffic to have Virtual Network Security Groups? and User Defined Routes applied; Default false"
        type: "boolean"
      - name: "websockets_enabled"
        description: "Should Websockets be enabled"
        type: "boolean"
      - name: "auto_swap_slot_name"
        description: "The name of the slot to automatically swap to during deployment"
        type: "string"
  - name: "cors"
    required: false
    description: "A Cors Block"
    required_vars:
      - name: "allowed_origins"
        description: "A list of origins which should be able to make cross-origin calls"
        type: "list"
    optional_vars:
      - name: "support_credentials"
        description: "Are credentials supported"
        type: "boolean"
  - name: "identity"
    required: false
    description: "An Identity Block"
    required_vars:
      - name: "type"
        description: "Specifies the identity type of the Function App; SystemAssigned or UserAssigned"
        type: "string"
    optional_vars:
      - name: "identity_ids"
        description: "Specifies a list of user managed identity ids; Required if type = userAssigned"
        type: "string"
  - name: "auth_settings"
    required: false
    description: "An auth settings block"
    required_vars:
      - name: "enabled"
        description: "Is Authentication enabled"
        type: "boolean"
    optional_vars:
      - name: "active_directory"
        description: "An Active Directory Block"
        type: "block"
      - name: "additional_login_params"
        description: "Login parameters to send to the OpenID Connect authorization endpoint; must be in form mey=value"
        type: "string"
      - name: "allowed_external_redirect_urls"
        description: "External URLs that can be redirected to as part of logging in or logging out of the app"
        type: "string"
      - name: "default_provider"
        description: "The default provider to use when multiple providers setup; AzureActiveDirectory, Facebook, Google, MicrosoftAccount or Twitter"
        type: "string"
      - name: "facebook"
        description: "A Facebook Block"
        type: "block"
      - name: "google"
        description: "A Google Block"
        type: "block"
      - name: "issuer"
        description: "An Issuer UR"
        type: "string"
      - name: "microsoft"
        description: "A Microsoft Block"
        type: "block"
      - name: "runtime_version"
        description: "The runtime version of the Authentication / Authorization module"
        type: "string"
      - name: "token_refresh_extension_hours"
        description: "The number of hours after session token expiration that a session token can be used to call the token refresh API"
        type: "string"
      - name: "token_store_enabled"
        description: "If enabled the module will durably store platform-specific security tokens; Default false"
        type: "boolean"
      - name: "twitter"
        description: "A Twitter Block"
        type: "block"
      - name: "unauthenticated_client_action"
        description: "The action to take when an unauthenticated client attempts to access the app; AllowAnonymous or RedirectToLoginPage"
        type: "string"
  - name: "active_directory"
    required: false
    parent_block: "auth_settings"
    description: "An Active Directory Block"
    required_vars:
      - name: "client_id"
        description: "The Client ID of this relying party application"
        type: "string"
    optional_vars:
      - name: "client_secret"
        description: "The Client Secret of this relying party application"
        type: "string"
      - name: "allowed_audiences"
        description: "Allowed audience values to consider when validating JWTs issued by AAD"
        type: "string"
  - name: "facebook"
    required: false
    parent_block: "auth_settings"
    description: "A Facebook Block"
    required_vars:
      - name: "app_id"
        description: "The App ID of the Facebook app used for login"
        type: "string"
      - name: "app_secret"
        description: "The App Secret of the Facebook app used for Facebook login"
        type: "string"
    optional_vars:
      - name: "oauth_scopes"
        description: "The OAuth 2.0 scopes that will be requested as part of Facebook login auth"
        type: "string"
  - name: "google"
    required: false
    parent_block: "auth_settings"
    description: "A Google Block"
    required_vars:
      - name: "client_id"
        description: "The OpenID Connect Client Id for the Google Web App"
        type: "string"
      - name: "client_secret"
        description: "The Client Secret associated with the Google Web App"
        type: "string"
    optional_vars:
      - name: "oauth_scopes"
        description: "The OAuth 2.0 scopes that will be requested as part of the Google Sign-in Auth"
        type: "string"
  - name: "microsoft"
    required: false
    parent_block: "auth_settings"
    description: "A Microsoft Block"
    required_vars:
      - name: "client_id"
        description: "The OpenID Connect Client Id for the auth app"
        type: "string"
      - name: "client_secret"
        description: "The Client Secret associated with the auth app"
        type: "string"
    optional_vars:
      - name: "oauth_scopes"
        description: "The OAuth 2.0 scopes that will be requested as part of the Microsoft Account"
        type: "string"
  - name: "twitter"
    required: false
    parent_block: "auth_settings"
    description: "A Twitter Block"
    required_vars:
      - name: "consumer_key"
        description: "The OAuth 1.0a consumer key of the Twitter app"
        type: "string"
      - name: "consumer_secret"
        description: "The OAuth 1.0a consumer secret of the Twitter app"
        type: "string"
  - name: "ip_restriction"
    required: false
    parent_block: "site_config"
    description: "An IP Restriction Block"
    optional_vars:
      - name: "ip_address"
        description: "The IP Address used for this IP Restriction"
        type: "string"
      - name: "service_tag"
        description: "The Service Tag used for this IP Restriction"
        type: "string"
      - name: "virtual_network_subnet_id"
        description: "The Virtual Network Subnet ID used for this IP Restriction"
        type: "string"
      - name: "name"
        description: "The Nae for this IP Restriction"
        type: "string"
      - name: "priority"
        description: "The Priority for this IP Restriction; Default 65000"
        type: "string"
      - name: "action"
        description: "Does this restriction Allow or Deny; Default Allow"
        type: "string"
      - name: "headers"
        description: "A Headers Block"
        type: "block"
  - name: "scm_ip_restriction"
    required: false
    parent_block: "site_config"
    description: "An SCM IP Restriction Block"
    optional_vars:
      - name: "ip_address"
        description: "The IP Address used for this IP Restriction"
        type: "string"
      - name: "service_tag"
        description: "The Service Tag used for this IP Restriction"
        type: "string"
      - name: "virtual_network_subnet_id"
        description: "The Virtual Network Subnet ID used for this IP Restriction"
        type: "string"
      - name: "name"
        description: "The Nae for this IP Restriction"
        type: "string"
      - name: "priority"
        description: "The Priority for this IP Restriction; Default 65000"
        type: "string"
      - name: "action"
        description: "Does this restriction Allow or Deny; Default Allow"
        type: "string"
      - name: "headers"
        description: "A Headers Block"
        type: "block"
  - name: "headers"
    required: false
    parent_block: "ip_restriction"
    description: "A Headers Block"
    optional_vars:
      - name: "x_azure_field"
        description: "A list of allowed Azure FrontDoor IDs in UUID notation; maximum of 8"
        type: "string"
      - name: "x_fd_health_probe"
        description: "A list to allow the Azure FRontDoor health probe header; Only allowed value is '1'"
        type: "string"
      - name: "x_forwarded_for"
        description: "A list of allowed 'X-Forwarded-For' IPs in CIDR notation; maximum of 8"
        type: "string"
      - name: "x_forwarded_host"
        description: "A list of allowed 'X-Forwarded-Host' domains; maximum of 8"
        type: "string"
  - name: "headers"
    required: false
    parent_block: "scm_ip_restriction"
    description: "A Headers Block"
    optional_vars:    
      - name: "x_azure_field"
        description: "A list of allowed Azure FrontDoor IDs in UUID notation; maximum of 8"
        type: "string"
      - name: "x_fd_health_probe"
        description: "A list to allow the Azure FRontDoor health probe header; Only allowed value is '1'"
        type: "string"
      - name: "x_forwarded_for"
        description: "A list of allowed 'X-Forwarded-For' IPs in CIDR notation; maximum of 8"
        type: "string"   
      - name: "x_forwarded_host"
        description: "A list of allowed 'X-Forwarded-Host' domains; maximum of 8"
        type: "string"
  - name: "source_control"
    required: false
    description: "A Source Control Block"
    optional_vars:
      - name: "repo_url"
        description: "The URL of the source code repository"
        type: "string"
      - name: "branch"
        description: "The branch of the remote repository to use; Default master"
        type: "string"
      - name: "manual_integration"
        description: "Limits to manual integration; Default false"
        type: "boolean"
      - name: "rollback_enabled"
        description: "Enable roll-back for the repository; Default false"
        type: "boolean"
      - name: "use_mercurial"
        description: "Use Mercurial if true, otherwise uses Git"
        type: "boolean"
