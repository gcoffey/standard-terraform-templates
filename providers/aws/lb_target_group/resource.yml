resource:
  name: "aws_lb_target_group"
  enable_variable_comments: false
  var_name: "lb_target_group"
  required_vars:
    - name: "port"
      description: "Port on which targets receive traffic, unless overridden"
      type: "string"
    - name: "protocol"
      description: "Protocol to use for routing traffic to the targets; GENEVE, HTTP, HTTPS, TCP, TCP_UDP, TLS or UDP"
      type: "string"
    - name: "target_type"
      description: "Type of target that you must specify when registering targets with this target group; Default is instance"
      type: "string"
  optional_vars:
    - name: "connection_termination"
      description: "Whether to terminate connections at the end of the deregistration timeout on NLBs"
      type: "boolean"
    - name: "deregistration_delay"
      description: "Amount of time for ELB to wait before changing state of target from draining to unused; Default is 300"
      type: "string"
    - name: "health_check"
      description: "Health check configuration block"
      type: "block"
    - name: "lambda_multi_value_headers_enabled"
      description: "Whether the request and response headers exchanged between the LB and the Lambda function; Default false"
      type: "boolean"
    - name: "load_balancing_algorithm_type"
      description: "Determines how the LB selects targets when routing requests; round_robin or least_outstanding_requests"
      type: "string"
    - name: "load_balancing_cross_zone_enabled"
      description: "Indicates whether cross zone load balancing is enabled; true or false"
      type: "boolean"
    - name: "name_prefix"
      description: "Creates a unique name beginning with the specified prefix"
      type: "string"
    - name: "name"
      description: "Name of the target group; Use name_prefix or name"
      type: "string"
    - name: "protocol_version"
      description: "Only applicable when protocol = HTTP or HTTPS; Default is HTTP1"
      type: "string"
    - name: "proxy_protocol_v2"
      description: "Whether to enable support for proxy protocol v2; Default false"
      type: "boolean"
    - name: "slow_start"
      description: "Amount time for targets to warm up before the LB sends them a full share of requests; Default is 0"
      type: "string"
    - name: "stickiness"
      description: "Stickiness configuration block"
      type: "block"
    - name: "target_failover"
      description: "Target Failover Block; For Gateway LB Target Groups only"
      type: "block"
    - name: "ip_address_type"
      description: "The type of IP addresses used by the target group, only supported when target type is set to ip; ipv4 or ipv6"
      type: "string"
    - name: "vpc_id"
      description: "Identifier of the VPC in which to create the target group"
      type: "string"
    - name: "tags"
      description: "Map of tags to assign to the resource"
      type: "list"

blocks:
  - name: "health_check"
    required: false
    description: "Health Check Block"
    required_vars:
      - name: "matcher"
        description: "Response codes to use when checking for a healthy response from a target; e.g. 200,202, 200-29"
        type: "string"
      - name: "path"
        description: "Destination for the health check request; Required for HTTP / HTTPS ALB and HTTP NLB"
        type: "string"
    optional_vars:
      - name: "enabled"
        description: "Whether health checks are enabled; Default true"
        type: "boolean"
      - name: "healthy_threshold"
        description: "Number of consecutive health check successes required before considering a target healthy; Default 3"
        type: "string"
      - name: "interval"
        description: "Approximate amount of time in seconds between health checks of an individual target; Default 30"
        type: "string"
      - name: "port"
        description: "The port the load balancer uses when performing health checks on targets; Default is traffic-port"
        type: "string"
      - name: "protocol"
        description: "Protocol the LB uses when performing health checks on targets; TCP, HTTP or HTTPS"
        type: "string"
      - name: "timeout"
        description: "Amount of time in seconds during which no response from a target means a failed health check"
        type: "string"
      - name: "unhealthy_threshold"
        description: "Number of consecutive health check failures required before considering a target unhealthy; Default 3"
        type: "string"
  - name: "stickiness"
    required: false
    description: "Stickiness Block"
    required_vars:
      - name: "type"
        description: "The type of sticky sessions; ALBs = lb_cookie or app_cookie, NLB = source_ip GWLB = source_ip_dest_ip or source_ip_dest_ip_proto"
        type: "string"
    optional_vars:
      - name: "cookie_duration"
        description: "Only used when the type is lb_cookie; Default is 1 day [86400 seconds]"
        type: "string"
      - name: "cookie_name"
        description: "Name of the application based cookie; AWSALB, AWSALBAPP or AWSALBTG"
        type: "string"
      - name: "enabled"
        description: "Enable or disable stickiness; Default true"
        type: "boolean"
  - name: "target_failover"
    required: false
    description: "Target Failover Block"
    optional_vars:
      - name: "on_deregistration"
        description: "Indicates how the GWLB handles existing flows when a target is deregistered; Default no_rebalance"
        type: "string"
      - name: "on_unhealthy"
        description: "Indicates how the GWLB handles existing flows when a target is unhealthy; Default no_rebalance"
        type: "string"
