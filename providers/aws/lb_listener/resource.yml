resource:
  name: "aws_lb_listener"
  enable_variable_comments: false
  var_name: "lb_listener"
  required_vars:
    - name: "default_action"
      description: "Default Action Block"
      type: "block"
    - name: "load_balancer_arn"
      description: "ARN of the load balancer"
      type: "string"
  optional_vars:
    - name: "alpn_policy"
      description: "Name of the Application Layer protocol negotiation; HTTP1Only, HTTP2Only, HTTP2Optional, HTTP2Preferred or None"
      type: "string"
    - name: "certificate_arn"
      description: "ARN of the default SSL server certificate; One certificate is required if the protocol is HTTPS"
      type: "string"
    - name: "port"
      description: "Port on which the load balancer is listening; Not valid for Gateway Load Balancers"
      type: "string"
    - name: "protocol"
      description: "Protocol for connections from clients to the load balancer; HTTP, HTTPS, TCP, TLS, UDP or TCP_UDP"
      type: "string"
    - name: "ssl_policy"
      description: "Name of the SSL Policy for the listener; Required if protocol = HTTPS or TLS"
      type: "string"
    - name: "tags"
      description: "A map of tags to assign to the resource"
      type: "list"

blocks:
  - name: "default_action"
    required: false
    description: "Default Action Block"
    required_vars:
      - name: "type"
        description: "Type of routing action; forward, redirect, fixed-response, authenticate-cognito or authenticate-oidc"
        type: "string"
    optional_vars:
      - name: "authenticate_cognito"
        description: "Configuration block for using Amazon Cognito to authenticate users; When type = authenticate-cognito"
        type: "block"
      - name: "authenticate_oidc"
        description: "Configuration block for an identity provider that is compliant with OpenID Connect"
        type: "block"
      - name: "fixed_response"
        description: "Information for creating an action that returns a custom HTTP response"
        type: "block"
      - name: "forward"
        description: "Configuration block for creating an action that distributes requests among one or more target groups"
        type: "block"
      - name: "order"
        description: "Order for the action. This value is required for rules with multiple actions"
        type: "string"
      - name: "redirect"
        description: "Configuration block for creating a redirect action"
        type: "block"
      - name: "target_group_arn"
        description: "ARN of the Target Group to which to route traffic"
        type: "string"
  - name: "authenticate_cognito"
    required: false
    parent_block: "default_action"
    description: "Authenticate Cognito Block"
    required_vars:
      - name: "user_pool_arn"
        description: "ARN of the Cognito User Pool"
        type: "string"
      - name: "user_pool_client_id"
        description: "ID of the Cognito user pool client"
        type: "string"
      - name: "user_pool_domain"
        description: "Domain prefix or fully-qualified domain name of the Cognito user pool"
        type: "string"
    optional_vars:
      - name: "authentication_request_extra_params"
        description: "Query parameters to include in the redirect request to the Auth endpoint"
        type: "string"
      - name: "on_unauthenticated_request"
        description: "Behavior if the user is not authenticated; deny, allow or authenticate"
        type: "string"
      - name: "scope"
        description: "Set of user claims to be requested from the IdP"
        type: "string"
      - name: "session_cookie_name"
        description: "Name of the cookie used to maintain session information"
        type: "string"
      - name: "session_timeout"
        description: "Maximum duration of the authetication session, in seconds"
        type: "string"
  - name: "authentication_request_extra_params"
    required: false
    parent_block: "authenticate_cognito"
    description: "Authentication Request Extra Params"
    required_vars:
      - name: "key"
        description: "Key of query param"
        type: "string"
      - name: "value"
        description: "Value of query param"
        type: "string"
  - name: "authenticate_oidc"
    required: false
    parent_block: "default_action"
    description: "Authenticate OIDC Block"
    required_vars:
      - name: "authorization_endpoint"
        description: "Authorization endpoint of the IdP"
        type: "string"
      - name: "client_id"
        description: "OAuth 2.0 client identifier"
        type: "string"
      - name: "client_secret"
        description: "OAuth 2.0 client secret"
        type: "string"
      - name: "issuer"
        description: "OIDC issue identifier of the IdP"
        type: "string"
      - name: "token_endpoint"
        description: "Token endpoint of the IdP"
        type: "string"
      - name: "user_info_endpoint"
        description: "User info endpoint of the IdP"
        type: "string"
    optional_vars:
      - name: "authentication_request_extra_params"
        description: "Authentication Request Extra Params Block"
        type: "block"
      - name: "on_unauthenticated_request"
        description: "Behavior if the user is not authenticated; deny, allow or authenticate"
        type: "string"
      - name: "scope"
        description: "Set of user claims to be requested from the IdP"
        type: "string"
      - name: "session_cookie_name"
        description: "Name of the cookie used to maintain session info"
        type: "string"
      - name: "session_timeout"
        description: "Maximum duration of the authentication session, in seconds"
        type: "string"
  - name: "fixed_response"
    required: false
    parent_block: "default_action"
    description: "Fixed REsponse Block"
    required_vars:
      - name: "content_type"
        description: "Content type; text/plain, text/css, text/html, application/javascript or application/json"
        type: "string"
    optional_vars:
      - name: "message_body"
        description: "Message body"
        type: "string"
      - name: "status_code"
        description: "HTTP response code; 2xx, 4xx or 5xx"
        type: "string"
  - name: "forward"
    required: false
    parent_block: "default_action"
    description: "Forward Block"
    required_vars:
      - name: "target_group"
        description: "Set of 1-5 target group blocks"
        type: "block"
    optional_vars:
      - name: "stickiness"
        description: "Config block for target group stickiness for the rule"
        type: "block"
  - name: "target_group"
    required: false
    parent_block: "forward"
    description: "Target Group Block"
    required_vars:
      - name: "arn"
        description: "ARN of the target group"
        type: "string"
    optional_vars:
      - name: "weight"
        description: "Weight. Range is 0 to 999"
        type: "block"
  - name: "stickiness"
    required: false
    parent_block: "forward"
    description: "Stickiness Block"
    required_vars:
      - name: "duration"
        description: "Time period, in seconds, during which request from a client should be routed to the same target group"
        type: "string"
    optional_vars:
      - name: "enabled"
        description: "Whether target group stickiness is enabled; Default false"
        type: "boolean"
  - name: "redirect"
    required: false
    parent_block: "default_action"
    description: "Redirect Block"
    required_vars:
      - name: "status_code"
        description: "HTTP redirect code; Either permanent HTTP_301 or temporary HTTP_302"
        type: "string"
    optional_vars:
      - name: "host"
        description: "Hostname; Default #{host}"
        type: "string"
      - name: "path"
        description: "Absolute path, starting with the leading '/'; Defaults to /#{path}"
        type: "string"
      - name: "port"
        description: "Port; Defaults to #{port}"
        type: "string"
      - name: "protocol"
        description: "Protocol; Valid values are HTTP, HTTPS or #{protocol}"
        type: "string"
      - name: "query"
        description: "Query parameters; Default #{query}"
        type: "string"
