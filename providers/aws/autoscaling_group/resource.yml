resource:
  name: "aws_autoscaling_group"
  enable_variable_comments: false
  var_name: "autoscaling_group"
  required_vars:
    - name: "max_size"
      description: "Maximum size of the Auto Scaling Group"
      type: "string"
    - name: "min_size"
      description: "Minimum size of the Auto Scaling Group"
      type: "string"
  optional_vars:
    - name: "name"
      description: "Name of the ASG; Conflicts with name_prefix"
      type: "string"
    - name: "name_prefix"
      description: "Creates a unique name beginning with the specified prefix; Conflicts with name"
      type: "string"
    - name: "availability_zones"
      description: "List of one or more availability zones for the group; Conflicts with vpc_zone_identifier"
      type: "list"
    - name: "capacity_rebalance"
      description: "Whether capacity rebalance is enabled"
      type: "boolean"
    - name: "context"
      description: "Reserved"
      type: "string"
    - name: "default_cooldown"
      description: "Amount of time, in seconds, after a scaling activity completes before another scaling activity can start"
      type: "string"
    - name: "default_instance_warmup"
      description: "Amount of time, in seconds, until a newly launched instance can contribute to the Amazon CloudWatch metrics"
      type: "string"
    - name: "launch_configuration"
      description: "Name of the launch configuration to use"
      type: "string"
    - name: "launch_template"
      description: "Launch Template Block"
      type: "block"
    - name: "mixed_instances_policy"
      description: "Configuration block containing settings to define launch targets for ASG"
      type: "block"
    - name: "initial_lifecycle_hook"
      description: "One or more lifecycle hooks to attach to the ASG"
      type: "block"
    - name: "health_check_grace_period"
      description: "Time, in seconds, after instance comes into service before checking health; Default 300"
      type: "string"
    - name: "health_check_type"
      description: "EC2 or ELB"
      type: "string"
    - name: "desired_capacity"
      description: "Number of Amazon EC2 instances that should be running in the group"
      type: "string"
    - name: "desired_capacity_type"
      description: "The unit of measurement for the value specified for desired_capacityi; units, vcpu or memory-mid"
      type: "string"
    - name: "force_delete"
      description: "Allows deleting the ASG without waiting for all instance in the pool to terminate"
      type: "boolean"
    - name: "load_balancers"
      description: "List of ELB names to add to the ASG names; For ALBs use target_group_arns"
      type: "list"
    - name: "vpc_zone_identifier"
      description: "List of Subnet IDs to launch resources in"
      type: "list"
    - name: "target_group_arns"
      description: "Set of aws_alb_target_group ARNS for use with Application or Network Load Balancing"
      type: "string"
    - name: "termination_policies"
      description: "List of policies to decide how the instances in the ASG should be terminated; OldestInstance, NewestInstance etc"
      type: "list"
    - name: "suspended_processes"
      description: "List of processes to suspend for the Auto Scaling Group; Launch, Terminate, HealthCheck etc"
      type: "list"
    - name: "tag"
      description: "Configuration block containing resource tags"
      type: "block"
    - name: "placement_group"
      description: "Name of the placement group into which you'll launch your instances"
      type: "string"
    - name: "metrics_granularity"
      description: "Granularity to associate with the metrics to collect; Default 1Minute"
      type: "string"
    - name: "enabled_metrics"
      description: "List of metrics to collect"
      type: "list"
    - name: "wait_for_capacity_timeout"
      description: "Maximum duration that Terraform should wait for ASG instances to be healthy before timing out; Default 10m"
      type: "string"
    - name: "min_elb_capacity"
      description: "Setting this causes Terraform to wait for this number of instances from the ASG to show up health in the ELB only on creation"
      type: "string"
    - name: "wait_for_elb_capacity"
      description: "Setting this will cause Terraform to wait for exactly this number of health instances in the ASG to be attached to the LB"
      type: "string"
    - name: "protect_from_scale_in"
      description: "Whether newly launched instances are automatically protectd from termination by EC2 Auto Scaling when scaling in"
      type: "boolean"
    - name: "service_linked_role_arn"
      description: "ARN of the service-linked role that the ASG will use to call other AWS services"
      type: "string"
    - name: "max_instance_lifetime"
      description: "Maximum amount of time, in seconds, that an instance can be in service"
      type: "string"
    - name: "instance_refresh"
      description: "If this block is configured, start an Instance refresh when this ASG is updated"
      type: "block"
    - name: "warm_pool"
      description: "Add a Warm pool to the specified ASG"
      type: "block"

blocks:
  - name: "launch_template"
    required: false
    description: "Launch Template Block"
    optional_vars:
      - name: "id"
        description: "ID of the launch template"
        type: "string"
      - name: "name"
        description: "Name of the launch template"
        type: "string"
      - name: "version"
        description: "Version of the launch template; $Latest or $Default"
        type: "string"
  - name: "mixed_instances_policy"
    required: false
    description: "Mixed Instances Policy Block"
    required_vars:
      - name: "launch_template"
        description: "Launch Template Block"
        type: "block"
    optional_vars:
      - name: "instances_distribution"
        description: "Instances Distribution Block"
        type: "block"
  - name: "launch_template"
    required: false
    parent_block: "mixed_instances_policy"
    description: "Launch Template Block"
    required_vars:
      - name: "launch_template_specification" 
        description: "Lauch Template Spec Block"
        type: "block"
    optional_vars:
      - name: "override"
        description: "Override Block"
        type: "block"
  - name: "launch_template_specification"
    required: false
    parent_block: "launch_template"
    description: "Launch Template Block"
    optional_vars:
      - name: "launch_template_id"
        description: "ID of the Launch Template"
        type: "string"
      - name: "launch_template_name"
        description: "Name of the launch Template"
        type: "string"
      - name: "version"
        description: "Template version; $Latest or $Default"
        type: "string"
  - name: "instances_distribution"
    required: false
    parent_block: "mixed_instances_policy"
    description: "Instances Distribution Block"
    optional_vars:
      - name: "on_demand_allocation_strategy"
        description: "Strategy to use when launching on-demand instances; prioritized or lowest-price"
        type: "string"
      - name: "on_demand_base_capacity"
        description: "Absolute minimum amount of desired capacity that must be fulfilled by on-demand instances; Default 0"
        type: "string"
      - name: "on_demand_percentage_above_base_capacity"
        description: "Percentage split between on-demand and spot instances above the base on-demand capacity; Default 100"
        type: "string"
      - name: "spot_allocation_strategy"
        description: "How to allocate capacity across spot pools; lowest-price, capacity-optimized, capacity-optimized-prioritized or price-capacity-optimized"
        type: "string"
      - name: "spot_instance_pools"
        description: "Number of Spot tools per availability zone to allocate capacity; Default 2"
        type: "string"
      - name: "spot_max_price"
        description: "Maximum price per unit hour that the user is willing to pay for the Spot instances"
        type: "string"
  - name: "override"
    required: false
    parent_block: "launch_template"
    description: "Override Block"
    optional_vars:
      - name: "instance_type"
        description: "Override the instance type in the launch template"
        type: "string"
      - name: "instance_requirements"
        description: "Override the instance type in the launch template with isntance types that satisfy the requirements"
        type: "string"
      - name: "launch_template_specification"
        description: "Override the instance launch template spec in the launch template"
        type: "string"
      - name: "weighted_capacity"
        description: "Number of capacity unites, which gives the instance type a proportional weight to other instance types"
        type: "string"
  - name: "instance_requirements"
    required: false
    parent_block: "override"
    description: "Instance Requirements Block"
    required_vars:
      - name: "vcpu_count"
        description: "Block describing the min and max number of vCPUs"
        type: "string"
    optional_vars:
      - name: "accelerator_count"
        description: "Block describing the minimum and maximum number of accelerators; Default is 0"
        type: "block"
      - name: "accelerator_manufacturers"
        description: "List of accelerator manufacturer names; Default is any manufacturer; amazon-web-services, amd, nvidia or xilinx"
        type: "list"
      - name: "accelerator_names"
        description: "List of accelerator names; Default is any; a100, v100, k80, t4, m60, radeon-pro-v520 or vu9p"
        type: "list"
      - name: "accelerator_total_memory_mib"
        description: "Block describing the minimum and maximum total memory of the accelerators"
        type: "string"
      - name: "accelerator_types"
        description: "List of accelerator types; Default is any; fpga, gpu or inference"
        type: "list"
      - name: "accelerator_instance_types"
        description: "List of instance types to apply your specified attributes against; c5*.*, m5a.*, r* etc"
        type: "list"
      - name: "bare_metal"
        description: "Indicate whether bare metal instance types should be include, excluded or required"
        type: "string"
      - name: "baseline_ebs_bandwidth_mbps"
        description: "Block describing the min and max baseline EBS bandwidth"
        type: "block"
      - name: "burstable_performance"
        description: "Indicate whether burstable performance instance types should be included, exclude or required"
        type: "string"
      - name: "cpu_manufacturers"
        description: "List of CPU manufacturer names; Default is any; amazon-web-services, amd or intel"
        type: "list"
      - name: "excluded_instance_types"
        description: "List of instance types to exclude; c5*, c5*.*, m5a.*, r* etc"
        type: "list"
      - name: "instance_generations"
        description: "List of instance generation names; Default is any generation; current or previous"
        type: "list"
      - name: "local_storage"
        description: "Indicate whether instance types with local storage volumes are included, exclude or required"
        type: "string"
      - name: "local_storage_types"
        description: "List of local storage type names; Default any; hdd or ssd"
        type: "list"
      - name: "memory_gib_per_vcpu"
        description: "Block describing the min and max amount of memory per vCPU; Default is 0"
        type: "block"
      - name: "memory_mib"
        description: "Block describing the min and max amount of memory; Default is 0"
        type: "block"
      - name: "network_bandwidth_gbps"
        description: "Block describing the min and max amount of network bandwidth; Default is 0"
        type: "block"
      - name: "network_interface_count"
        description: "Block describing the min and max amount of network interfaces;"
        type: "block"
      - name: "on_demand_max_price_percentage_over_lowest_price"
        description: "Price protection threshold for on-demand instances; Default is 20"
        type: "string"
      - name: "required_hibrenate_support"
        description: "Indicate whether instance types must support On-Demand Instance Hibernation; Default false"
        type: "boolean"
      - name: "spot_max_price_percentage_over_lowest_price"
        description: "Price protection threshold for Spot instances; Default 100"
        type: "string"
      - name: "total_local_storage_gb"
        description: "Block describing the min and max amount of Local Storage (GB)"
        type: "block"
      - name: "tag"
        description: "A tag Block"
        type: "block"
  - name: "accelerator_count"
    required: false
    parent_block: "instance_requirements"
    description: "Accelerator Count Block"
    optional_vars:
      - name: "min"
        description: "Minimum Accelerator Count"
        type: "string"
      - name: "max"
        description: "Maximum Accelerator Count"
        type: "string"
  - name: "baseline_ebs_bandwidth_mbps"
    required: false
    parent_block: "instance_requirements"
    description: "Baseline EBS Bandwidth MBps Block"
    optional_vars:
      - name: "min"
        description: "Minimum MBps"
        type: "string"
      - name: "max"
        description: "Maximum MBps"
        type: "string"
  - name: "memory_gib_per_vcpu"
    required: false
    parent_block: "instance_requirements"
    description: "Memory GiB per vCPU Block"
    optional_vars:
      - name: "min"
        description: "Minimum Memory"
        type: "string"
      - name: "max"
        description: "Maximum Memory"
        type: "string"
  - name: "memory_mib"
    required: false
    parent_block: "instance_requirements"
    description: "Memory MiB Block"
    optional_vars:
      - name: "min"
        description: "Minimum Memory"
        type: "string"
      - name: "max"
        description: "Maximum Memory"
        type: "string"
  - name: "network_bandwidth_gbps"
    required: false
    parent_block: "instance_requirements"
    description: "Network Bandwidth Gbps Block"
    optional_vars:
      - name: "min"
        description: "Minimum Bandwidth"
        type: "string"
      - name: "max"
        description: "Maximum Bandwidth"
        type: "string"
  - name: "network_interface_count"
    required: false
    parent_block: "instance_requirements"
    description: "Network Interface Count Block"
    optional_vars:
      - name: "min"
        description: "Minimum Interfaces"
        type: "string"
      - name: "max"
        description: "Maximum Interfaces"
        type: "string"
  - name: "accelerator_total_memory_mib"
    required: false
    parent_block: "instance_requirements"
    description: "Accelerator Total Memory Block"
    optional_vars:
      - name: "min"
        description: "Minimum Accelerator Memory"
        type: "string"
      - name: "max"
        description: "Maximum Accelerator Memory"
        type: "string"
  - name: "total_local_storage_gb"
    required: false
    parent_block: "instance_requirements"
    description: "Total Local Storage Block"
    optional_vars:
      - name: "min"
        description: "Minimum Storage"
        type: "string"
      - name: "max"
        description: "Maximum Storage"
        type: "string"
  - name: "vcpu_count"
    required: true
    parent_block: "instance_requirements"
    description: "vCPU Count Block"
    required_vars:
      - name: "min"
        description: "Minimum vCPU"
        type: "string"
    optional_vars:
      - name: "max"
        description: "Maximum vCPU"
        type: "string"
  - name: "tag"
    required: false
    parent_block: "instance_requirements"
    description: "Tag Block"
    required_vars:
      - name: "key"
        description: "Tag Key"
        type: "string"   
      - name: "value"
        description: "Tag Value"
        type: "string"
      - name: "propagate_at_launch"
        description: "Enables propagation of the tag to EC2 instances via this ASG"
        type: "boolean"
  - name: "instance_refresh"
    required: false
    description: "Instance Refresh Block"
    required_vars:
      - name: "strategy"
        description: "Strategy to use for instance refresh; Rolling is the only allowed value"
        type: "string"
    optional_vars:
      - name: "preferences"
        description: "Override default parameters for Instance Refresh"
        type: "block"
      - name: "triggers"
        description: "Set of additional property names that will trigger an Instance Refresh"
        type: "list"
  - name: "preferences"
    required: false
    parent_block: "instance_refresh"
    description: "Preferences Block"
    optional_vars:
      - name: "checkpoint_delay"
        description: "Number of seconds to wait after a checkpoint; Default 3600"
        type: "string"
      - name: "checkpoint_percentages"
        description: "List of percentages for each checkpoint"
        type: "list"
      - name: "instance_warmup"
        description: "Number of seconds until a newly launched instance is configurd and ready to use"
        type: "string"
      - name: "min_health_percentage"
        description: "Amount of capacity in the ASG that must remain health during an instance refresh; Default 90"
        type: "string"
      - name: "skip_matching"
        description: "Replace instances that already have your desired configuration; Default false"
        type: "boolean"
      - name: "auto_rollback"
        description: "Automatically rollback if instance refresh fails; Default false"
        type: "string"
  - name: "warm_pool"
    required: false
    description: "Warm Pool Block"
    optional_vars:
      - name: "pool_state"
        description: "Sets the instance state to transition to after the lifecycle hooks finish; Stopped, Running or Hibernated"
        type: "string"
      - name: "min_size"
        description: "Min number of instances to maintain in the warm pool; Default 0"
        type: "string"
      - name: "instance_reuse_policy"
        description: "Whether instances in the ASG can be returned to the warm pool on scale in"
        type: "string"
      - name: "max_group_prepared_capacity"
        description: "Total max number of instances that are allowd to be in the warm pool"
        type: "string"
      - name: "skip_matching"
        description: "Replace instances that already have your desired configuration; Default false"
        type: "boolean"
      - name: "auto_rollback"
        description: "Automatically rollback if instance refresh fails; Default false"
        type: "string"
  - name: "instance_reuse_policy"
    required: false
    parent_block: "warm_pool"
    description: "Instance Reuse Policy"
    optional_vars:
      - name: "reuse_on_scale_in"
        description: "Whether instances in the ASG can be returned to the warm pool on scale in"
        type: "string"
